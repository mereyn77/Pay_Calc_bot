<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | {period}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.6);
            --blue-primary: #1e40af;
            --blue-light: #3b82f6;
            --green: #10b981;
            --red: #ef4444;
            --yellow: #f59e0b;
            --cyan: #06b6d4;
            --text-white: #ffffff;
            --text-gray: #cbd5e1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1e293b 100%);
            color: var(--text-white);
            min-height: 100vh;
            padding-bottom: 2rem;
        }

        /* –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .auth-modal {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .auth-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
            background: linear-gradient(135deg, var(--blue-light), var(--cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .password-input {
            margin: 2rem 0;
        }

        .password-input input {
            width: 100%;
            padding: 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: var(--text-white);
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .password-input input:focus {
            outline: none;
            border-color: var(--blue-light);
            background: rgba(59, 130, 246, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, var(--blue-primary), var(--blue-light));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .auth-error {
            color: var(--red);
            text-align: center;
            margin-top: 1rem;
            display: none;
        }

        .auth-hint {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .auth-hint code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .hidden {
            display: none !important;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–∞—à–±–æ—Ä–¥–∞ */
        header {
            background: linear-gradient(135deg, var(--blue-primary) 0%, var(--blue-light) 100%);
            padding: 0.8rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .header-title {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .header-subtitle {
            font-size: 1rem;
            font-weight: 400;
            opacity: 0.8;
            margin-top: 0.3rem;
        }

        .branch-selector {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.3rem;
            border-radius: 8px;
        }

        .branch-btn {
            padding: 0.6rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-white);
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .branch-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .branch-btn.active {
            background: var(--text-white);
            color: var(--blue-primary);
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-white);
        }

        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 40px;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(30, 64, 175, 0.2) 100%);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .kpi-text {
            flex: 1;
        }
        
        .kpi-icon {
            font-size: 1.8rem;
            margin-bottom: 0;
        }
        
        .kpi-label {
            font-size: 0.95rem;
            color: var(--text-gray);
            margin-bottom: 0.2rem;
        }
        
        .kpi-value {
            font-size: 1.05rem;
            font-weight: 500;
            color: var(--text-white);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .table-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .control-label {
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        select, input[type="text"] {
            padding: 0.6rem 1rem;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(30, 41, 59, 0.8);
            color: var(--text-white);
            font-size: 0.95rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.87rem;
            padding-bottom: 40px;
        }

        .data-table th {
            background: rgba(30, 64, 175, 1);
            padding: 0.6rem 0.3rem;
            text-align: left;
            font-weight: 400;
            font-size: 0.97rem;
            cursor: pointer;
            position: sticky;
            top: 0px;
            z-index: 20;
            user-select: none;
            white-space: nowrap;
        }

        .data-table th:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        .data-table td {
            padding: 0.5rem 0.3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
        }

        .data-table tbody tr {
            transition: background 0.2s;
        }

        .data-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .data-table tbody tr.warning {
            background: rgba(239, 68, 68, 0.1);
        }

        .col-dept {
            max-width: 130px;
            min-width: 100px;
        }

        /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ –§–ò–û (–ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞) */
        .data-table td:first-child {
            max-width: 160px;
            min-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .col-vacation, .col-weekend, .col-sick {
            width: 40px;
            min-width: 40px;
            max-width: 40px;
        }

        /* –®–∏—Ä–∏–Ω–∞ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ –ß–∞—Å–æ–≤ */
        .data-table td:nth-child(6) {
            min-width: 55px;
            max-width: 60px;
        }

        /* –®–∏—Ä–∏–Ω–∞ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ –î–æ–ª—è */
        .data-table td:nth-child(7) {
            min-width: 57px;
            max-width: 65px;
        }

        /* –®–∏—Ä–∏–Ω–∞ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ –î–æ–ª–µ–≤. –ø—Ä–µ–º. */
        .data-table td:nth-child(8) {
            min-width: 60px;
            max-width: 70px;
        }

        /* –ü—Ä–µ–º–∏—è –æ–ø—Ç - 11-—è –∫–æ–ª–æ–Ω–∫–∞ */
        .data-table td:nth-child(12) {
            min-width: 60px;
            max-width: 65px;
        }

        /* –°—Ö–µ–º–∞ - 12-—è –∫–æ–ª–æ–Ω–∫–∞ */
        .data-table td:nth-child(13) {
            min-width: 60px;
            max-width: 70px;
        }

        /* –ì–∞—Ä–∞–Ω—Ç–∏–∏ - 13-—è –∫–æ–ª–æ–Ω–∫–∞ */
        .data-table td:nth-child(14) {
            min-width: 60px;
            max-width: 70px;
        }

        /* –†–∞–∑–Ω–∏—Ü–∞ - 14-—è –∫–æ–ª–æ–Ω–∫–∞ */
        .data-table td:nth-child(15) {
            min-width: 60px;
            max-width: 70px;
        }
        
        .col-premium {
            max-width: 90px;
            min-width: 80px;
        }
        
        .col-category {
            max-width: 70px;
            min-width: 60px;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ */
        .data-table tbody tr.selected {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.4), rgba(30, 64, 175, 0.4)) !important;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            border-left: 4px solid var(--blue-light);
            transform: scale(1.005);
            transition: all 0.3s ease;
        }

        .data-table tbody tr.faded {
            opacity: 0.15;
            filter: blur(0.4px);
            transition: all 0.3s ease;
        }

        .data-table tbody tr.faded td:first-child,
        .data-table tbody tr.faded td:last-child {
            opacity: 0.15;
            filter: blur(0.5px);
        }

        .data-table tbody tr.selected td {
            font-weight: 330;
            color: var(--text-white) !important;
            font-size: 1rem;
        }

        .data-table tbody tr.selected .text-red,
        .data-table tbody tr.selected .text-green {
            color: var(--text-white) !important;
            font-weight: 400;
        }

        .pair-group-1 {
            background: rgba(16, 185, 129, 0.2);
        }
        
        .pair-group-2 {
            background: rgba(59, 130, 246, 0.2);
        }
        
        .pair-group-3 {
            background: rgba(245, 158, 11, 0.2);
        }
        
        .pair-group-4 {
            background: rgba(147, 51, 234, 0.2);
        }
        
        .pair-group-5 {
            background: rgba(239, 68, 68, 0.2);
        }

        .pair-group-6 {
            background: rgba(168, 85, 247, 0.2);
        }

        .prem-retail {
            background: rgba(16, 185, 129, 0.15);
            border-left: 1px solid var(--green);
        }

        .prem-opt {
            background: rgba(245, 158, 11, 0.15);
            border-left: 1px solid var(--yellow);
        }

        .total-column {
            font-size: 1.02em !important;
            font-weight: 300 !important;
            color: var(--text-white) !important;
            letter-spacing: 0.5px !important;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 450px;
            margin-top: 0.7rem;
            padding-bottom: 20px;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-white);
        }

        .top-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .rank-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.2rem;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .rank-card.anti {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .rank-number {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            line-height: 2rem;
            text-align: center;
            border-radius: 50%;
            background: var(--green);
            color: white;
            font-weight: 700;
            margin-right: 0.5rem;
        }

        .rank-card.anti .rank-number {
            background: var(--red);
        }

        .rank-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .rank-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.3rem;
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        .leaders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .leader-block {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 1rem;
            border-left: 4px solid var(--cyan);
        }

        .leader-block h3 {
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
            color: var(--cyan);
        }

        .leader-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .problems-grid {
            display: grid;
            gap: 1.5rem;
        }

        .problem-block {
            background: rgba(239, 68, 68, 0.1);
            border-radius: 10px;
            padding: 1.2rem;
            border-left: 4px solid var(--red);
        }

        .problem-block h3 {
            color: var(--red);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green) 0%, var(--cyan) 100%);
            transition: width 0.3s;
        }

        .progress-fill.low {
            background: linear-gradient(90deg, var(--red) 0%, var(--yellow) 100%);
        }

        .zakaz-group {
            background: rgba(236, 72, 153, 0.2);
            border-left: 2px solid rgba(236, 72, 153, 0.5);
        }

        .chart-type-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .chart-type-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .chart-type-btn.active {
            background: var(--blue-light);
            border-color: var(--blue-light);
            font-weight: bold;
        }

        .separator {
            width: 10px !important;
            min-width: 10px !important;
            max-width: 10px !important;
            background-color: var(--bg-dark) !important;
            border: none !important;
            padding: 0 !important;
        }

        .assortment-group {
            background: rgba(168, 85, 247, 0.2);
            border-left: 2px solid rgba(168, 85, 247, 0.5);
        }

        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .text-yellow { color: var(--yellow); }
        .text-cyan { color: var(--cyan); }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .kpi-grid, .top-grid, .leaders-grid {
                grid-template-columns: 1fr;
            }
            .data-table { font-size: 0.7rem;
                          padding-bottom: 20px; }
            .data-table th, .data-table td { padding: 0.4rem 0.2rem; }
        }
    </style>
</head>
<body>
    <!-- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authOverlay" class="auth-overlay">
        <div class="auth-modal">
            <h1 class="auth-title">üîê –î–æ—Å—Ç—É–ø –∫ –¥–∞—à–±–æ—Ä–¥—É</h1>
            <p style="text-align: center; color: var(--text-gray); margin-bottom: 2rem;">
                –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Ñ–∏–ª–∏–∞–ª–∞ –∏–ª–∏ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å
            </p>
            
            <div class="password-input">
                <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." autocomplete="off">
            </div>
            
            <button class="auth-btn" id="loginBtn">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
            
            <div id="authError" class="auth-error">
                ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
            </div>
            
            <div class="auth-hint">
                <strong>–¢–µ—Å—Ç–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏:</strong><br>
                ‚Ä¢ –ú–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å (–¥–∏—Ä–µ–∫—Ç–æ—Ä): <code>MASTER_KEY</code><br>
                ‚Ä¢ –§–∏–ª–∏–∞–ª –ë–î1: <code>BD1_PASS</code><br>
                ‚Ä¢ –§–∏–ª–∏–∞–ª –ë–î3: <code>BD3_PASS</code><br>
                ‚Ä¢ –§–∏–ª–∏–∞–ª –ë–î4: <code>BD4_PASS</code>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–∞—à–±–æ—Ä–¥–∞ (—Å–∫—Ä—ã—Ç –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div id="dashboard" class="hidden">
        <header>
            <div class="header-content">
                <div>
                    <div class="header-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                    <div class="header-subtitle">{period}</div>
                </div>
                <div class="branch-selector">
                    <button class="branch-btn" data-branch="bd1">–ë–î1</button>
                    <button class="branch-btn" data-branch="bd3">–ë–î3</button>
                    <button class="branch-btn active" data-branch="bd4">–ë–î4</button>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- KPI Cards - –ß–ê–°–´ -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-icon">üè¢</div>
                    <div class="kpi-text">
                        <div class="kpi-label">–û—Ç–¥–µ–ª—ã / –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
                        <div class="kpi-value" id="kpi-depts-emps">0 / 0</div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">‚è±Ô∏è</div>
                    <div class="kpi-text">
                        <div class="kpi-label">–ù–æ—Ä–º—ã: –ú–∞–≥–∞–∑–∏–Ω / –û—Ñ–∏—Å</div>
                        <div class="kpi-value" id="kpi-norms">0 / 0</div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üìÖ</div>
                    <div class="kpi-text">
                        <div class="kpi-label">–û—Ç–ø. / –í—ã—Ö. / –ë–æ–ª. / –ù–µ–≤—ã—Ö.</div>
                        <div class="kpi-value" id="kpi-absences">0 / 0 / 0 / 0</div>
                    </div>
                </div>
            </div>

            <!-- Main Table -->
            <div class="section">
                <h2 class="section-title">–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
                <div class="glass-card">
                    <div class="table-controls">
                        <div class="control-group">
                            <label class="control-label">–û—Ç–¥–µ–ª</label>
                            <select id="dept-filter">
                                <option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-label">–ü–æ–∏—Å–∫ –ø–æ –§–ò–û</label>
                            <input type="text" id="name-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <div style="max-height: 500px; overflow-y: auto; margin-top: 10px;">
                            <table class="data-table" id="main-table">
                                <thead>
                                    <tr>
                                        <th>–§–ò–û</th>
                                        <th class="col-dept">–û—Ç–¥–µ–ª</th>
                                        <th class="col-vacation">–û—Ç–ø.</th>
                                        <th class="col-weekend">–í—ã—Ö.</th>
                                        <th class="col-sick">–ë–æ–ª.</th>
                                        <th>–ß–∞—Å–æ–≤</th>
                                        <th>–î–æ–ª—è</th>
                                        <th class="col-premium">–î–æ–ª–µ–≤–∞—è. –ø—Ä–µ–º.</th>
                                        <th class="col-category">–û–±—ã—á–Ω.</th>
                                        <th class="col-category">–ë–æ–Ω.</th>
                                        <th class="col-category">–ù–µ–ª–∏–∫.</th>
                                        <th class="col-premium">–ü—Ä–µ–º–∏—è –æ–ø—Ç</th>
                                        <th>–°—Ö–µ–º–∞</th>
                                        <th>–ì–∞—Ä–∞–Ω—Ç–∏–∏</th>
                                        <th>–†–∞–∑–Ω–∏—Ü–∞</th>
                                        <th>–ò–¢–û–ì–û</th>
                                    </tr>
                                </thead>
                                <tbody id="table-body">
                                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í—Ç–æ—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø—Ä–æ–¥–∞–∂ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤ -->
            <div class="section">
                <h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø—Ä–æ–¥–∞–∂ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤</h2>
                <div class="glass-card">
                    <div class="table-controls">
                        <div class="control-group">
                            <label class="control-label">–û—Ç–¥–µ–ª</label>
                            <select id="dept-filter-stats">
                                <option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-label">–ü–æ–∏—Å–∫ –ø–æ –§–ò–û</label>
                            <input type="text" id="name-search-stats" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <div style="max-height: 500px; overflow-y: auto; margin-top: 10px;">
                            <table class="data-table" id="stats-table">
                                <thead>
                                    <tr>
                                        <th>–§–ò–û</th>
                                        <th>–û—Ç–¥–µ–ª</th>
                                        <th>–î–æ–ª—è —Ä–æ–∑–Ω.</th>
                                        <th>–ö–æ–ª. —Ä–æ–∑–Ω.</th>
                                        <th>–î–æ–ª—è –æ–ø—Ç</th>
                                        <th>–ö–æ–ª. –æ–ø—Ç</th>
                                        <th>–î–æ–ª—è –ø—Ä–æ—á.</th>
                                        <th>–ö–æ–ª. –ø—Ä–æ—á.</th>
                                        <th class="separator"></th>
                                        <th>–î–æ–ª—è –æ–±—ã—á–Ω.</th>
                                        <th>–ö–æ–ª. –æ–±—ã—á–Ω.</th>
                                        <th>–î–æ–ª—è –±–æ–Ω—É—Å.</th>
                                        <th>–ö–æ–ª. –±–æ–Ω—É—Å.</th>
                                        <th>–î–æ–ª—è –Ω–µ–ª–∏–∫.</th>
                                        <th>–ö–æ–ª. –Ω–µ–ª–∏–∫.</th>
                                        <th>–î–æ–ª—è –ø—Ä–æ–¥.</th>
                                    </tr>
                                </thead>
                                <tbody id="stats-body">
                                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top 5 -->
            <div class="section">
                <h2 class="section-title">–¢–æ–ø-5 –ø—Ä–æ–¥–∞–≤—Ü–æ–≤</h2>
                <div class="top-grid" id="top5-grid"></div>
            </div>

            <!-- Anti Top 5 -->
            <div class="section">
                <h2 class="section-title">–ê–Ω—Ç–∏-—Ç–æ–ø-5</h2>
                <div class="top-grid" id="antitop5-grid"></div>
            </div>

            <!-- Leaders by Category -->
            <div class="section">
                <h2 class="section-title">–õ–∏–¥–µ—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
                <div class="leaders-grid">
                    <div class="leader-block">
                        <h3>üéÅ –ü–æ –±–æ–Ω—É—Å–Ω—ã–º —Ç–æ–≤–∞—Ä–∞–º</h3>
                        <div id="leaders-bonus"></div>
                    </div>
                    <div class="leader-block">
                        <h3>üì¶ –ü–æ –Ω–µ–ª–∏–∫–≤–∏–¥–Ω—ã–º</h3>
                        <div id="leaders-nonliquid"></div>
                    </div>
                    <div class="leader-block">
                        <h3>üõçÔ∏è –ü–æ —Ä–æ–∑–Ω–∏—á–Ω—ã–º</h3>
                        <div id="leaders-retail"></div>
                    </div>
                    <div class="leader-block">
                        <h3>üè≠ –ü–æ –æ–ø—Ç–æ–≤—ã–º</h3>
                        <div id="leaders-wholesale"></div>
                    </div>
                </div>
            </div>

            <!-- Problem Areas -->
            <div class="section">
                <h2 class="section-title">–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞</h2>
                <div class="problems-grid">
                    <div class="problem-block">
                        <h3>‚ö†Ô∏è –ù–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–§–ò–û</th>
                                    <th>–û—Ç–¥–µ–ª</th>
                                    <th>–ß–∞—Å—ã</th>
                                    <th>–í—ã—Ä—É—á–∫–∞</th>
                                    <th>–í—ã—Ä/—á–∞—Å</th>
                                </tr>
                            </thead>
                            <tbody id="problem-efficiency"></tbody>
                        </table>
                    </div>
                    <div class="problem-block">
                        <h3>üí∞ –î–æ–ø–ª–∞—Ç–∞ –¥–æ –º–∏–Ω–∏–º–∞–ª–∫–∏</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–§–ò–û</th>
                                    <th>–û—Ç–¥–µ–ª</th>
                                    <th>–ò–¢–û–ì–û</th>
                                    <th>–î–æ–ø–ª–∞—Ç–∞</th>
                                </tr>
                            </thead>
                            <tbody id="problem-minimum"></tbody>
                        </table>
                    </div>
                    <div class="problem-block">
                        <h3>üìÖ –ú–Ω–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–§–ò–û</th>
                                    <th>–û—Ç–¥–µ–ª</th>
                                    <th>–û—Ç–ø—É—Å–∫</th>
                                    <th>–í—ã—Ö.</th>
                                    <th>–ë–æ–ª.</th>
                                    <th>–í—Å–µ–≥–æ</th>
                                </tr>
                            </thead>
                            <tbody id="problem-absences"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Department Stats -->
            <div class="section">
                <h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º</h2>
                <div class="glass-card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–û—Ç–¥–µ–ª</th>
                                <th>–°–æ—Ç—Ä.</th>
                                <th>–°—Ä. –ó–ü</th>
                                <th>–ß–∞—Å–æ–≤</th>
                                <th>–ù–æ—Ä–º–∞</th>
                                <th>–í—ã—Ö.</th>
                                <th>–û—Ç–ø.</th>
                                <th>–ë–æ–ª.</th>
                                <th>–ù–µ–≤—ã—Ö.</th>
                                <th>% –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —á–∞—Å–æ–≤</th>
                            </tr>
                        </thead>
                        <tbody id="dept-stats"></tbody>
                    </table>
                </div>
            </div>

            <!-- –î–∏–∞–≥—Ä–∞–º–º—ã -->
            <div class="section">
                <h2 class="section-title">–î–∏–∞–≥—Ä–∞–º–º—ã</h2>
                
                <div class="glass-card">
                    <div class="chart-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div class="chart-title" style="margin-bottom: 0;">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥–∞–∂ –ø–æ –æ—Ç–¥–µ–ª–∞–º</div>
                            <div id="legend-salesTypes" style="display: flex; gap: 20px;"></div>
                        </div>
                        <canvas id="salesTypesChart"></canvas>
                    </div>
                </div>

                <div class="glass-card" style="margin-top: 1.5rem;">
                    <div class="chart-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div class="chart-title" style="margin-bottom: 0;">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –æ—Ç–¥–µ–ª–∞–º</div>
                            <div id="legend-productCategories" style="display: flex; gap: 20px;"></div>
                        </div>
                        <canvas id="productCategoriesChart"></canvas>
                    </div>
                </div>

                <div class="glass-card" style="margin-top: 1.5rem;">
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div class="chart-title" style="margin-bottom: 0;">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∑–∞–∫–∞–∑–Ω—ã—Ö –∏ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –æ—Ç–¥–µ–ª–∞–º</div>
                            <div id="legend-customVsAssortment" style="display: flex; gap: 20px;"></div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <button onclick="changeZakazChartType('items')" class="chart-type-btn active">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–µ–¥.)</button>
                            <button onclick="changeZakazChartType('revenue')" class="chart-type-btn">–í—ã—Ä—É—á–∫–∞</button>
                            <button onclick="changeZakazChartType('profit')" class="chart-type-btn">–ü—Ä–∏–±—ã–ª—å</button>
                        </div>
                        <canvas id="customVsAssortmentChart"></canvas>
                    </div>
                </div>
                
                <!-- –ó–∞–∫–∞–∑–Ω—ã–µ –∏ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
                <div class="section" style="margin-top: 2rem;">
                    <h2 class="section-title">–ó–∞–∫–∞–∑–Ω—ã–µ –∏ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
                    <div class="glass-card">
                        <div class="table-controls">
                            <div class="control-group">
                                <label class="control-label">–û—Ç–¥–µ–ª</label>
                                <select id="dept-filter-zakaz">
                                    <option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">–ü–æ–∏—Å–∫ –ø–æ –§–ò–û</label>
                                <input type="text" id="name-search-zakaz" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
                            </div>
                        </div>
                        <div style="overflow-x: auto; padding-bottom: 10px;">
                            <div style="max-height: 500px; overflow-y: auto; margin-top: 10px;">
                                <table class="data-table" id="zakaz-table">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 120px;">–§–ò–û</th>
                                            <th style="min-width: 90px;">–û—Ç–¥–µ–ª</th>
                                            <th class="zakaz-group" style="min-width: 60px;">–ü—Ä–æ–¥–∞–∂–∏ –∑–∞–∫–∞–∑</th>
                                            <th class="zakaz-group" style="min-width: 60px;">–ü—Ä–∏–±—ã–ª—å –∑–∞–∫–∞–∑</th>
                                            <th class="zakaz-group" style="min-width: 60px;">–ö–æ–ª-–≤–æ –∑–∞–∫–∞–∑</th>
                                            <th class="assortment-group" style="min-width: 60px;">–ü—Ä–æ–¥–∞–∂–∏ –∞—Å—Å–æ—Ä—Ç</th>
                                            <th class="assortment-group" style="min-width: 60px;">–ü—Ä–∏–±—ã–ª—å –∞—Å—Å–æ—Ä—Ç</th>
                                            <th class="assortment-group" style="min-width: 60px;">–ö–æ–ª-–≤–æ –∞—Å—Å–æ—Ä—Ç</th>
                                            <th style="min-width: 350px;">% –∑–∞–∫–∞–∑/–∞—Å—Å–æ—Ä—Ç</th>
                                        </tr>
                                    </thead>
                                    <tbody id="zakaz-body">
                                        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∏ –ø–∞—Ä–æ–ª–∏ - –±—É–¥—É—Ç –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã Python
        const allData = {data_json};
        const passwords = {passwords_json};
        const reportPeriod = "{period}";
        
        let currentBranch = 'bd4';
        let currentData = [];
        let currentAccess = null;

        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–ª–∞–≥–∏–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∞—Ö
        Chart.register(ChartDataLabels);

        // –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function checkPassword() {
            const password = document.getElementById('passwordInput').value.trim();
            const errorElement = document.getElementById('authError');
            
            if (password === passwords.ALL) {
                currentAccess = 'ALL';
                showDashboard();
                return;
            }
            
            if (password === passwords.bd1) {
                currentAccess = 'bd1';
                currentBranch = 'bd1';
                showDashboard();
                return;
            }
            if (password === passwords.bd3) {
                currentAccess = 'bd3';
                currentBranch = 'bd3';
                showDashboard();
                return;
            }
            if (password === passwords.bd4) {
                currentAccess = 'bd4';
                currentBranch = 'bd4';
                showDashboard();
                return;
            }
            
            errorElement.style.display = 'block';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').focus();
        }

        function showDashboard() {
            document.getElementById('authOverlay').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // –ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã
            if (currentAccess === 'ALL') {
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤
                currentData = [];
                for (const branch in allData) {
                    currentData = currentData.concat(allData[branch]);
                }
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª–∏–∞–ª–æ–≤
                document.querySelectorAll('.branch-btn').forEach(btn => {
                    btn.classList.add('active');
                });
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∏–ª–∏–∞–ª
                currentData = allData[currentAccess] || [];
                // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏, –∑–∞—Ç–µ–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é
                document.querySelectorAll('.branch-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.branch-btn[data-branch="' + currentAccess + '"]').classList.add('active');
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥—Ä—É–≥–∏—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤
                document.querySelectorAll('.branch-btn').forEach(btn => {
                    if (btn.dataset.branch !== currentAccess) {
                        btn.style.display = 'none';
                    }
                });
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadBranch(currentBranch);
        }

        function renderTable(filterDept = '', searchName = '') {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            let filtered = currentData.filter(emp => {
                const deptMatch = !filterDept || emp.dept === filterDept;
                const nameMatch = !searchName || emp.fio.toLowerCase().includes(searchName.toLowerCase());
                return deptMatch && nameMatch;
            });

            filtered.forEach(emp => {
                const row = document.createElement('tr');
                const isUnderworked = emp.worked < emp.norm * 0.9;
                if (isUnderworked) row.classList.add('warning');
                
                const vacation = emp.vacation ? emp.vacation : '-';
                const weekend = emp.weekend ? emp.weekend : '-';
                const sick = emp.sick ? emp.sick : '-';
                const premOptTotal = emp.premWholesale + emp.premOther;

                row.innerHTML = `
                    <td>${emp.fio}</td>
                    <td class="col-dept">${emp.dept}</td>
                    <td class="col-vacation">${vacation}</td>
                    <td class="col-weekend">${weekend}</td>
                    <td class="col-sick">${sick}</td>
                    <td class="${isUnderworked ? 'text-red' : ''}">${emp.worked.toFixed(1).replace('.', ',')}</td>
                    <td>${emp.rating.toFixed(2).replace('.', ',')} %</td>
                    <td class="prem-retail col-premium">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.dol_prem || 0))}</td>
                    <td class="prem-retail col-category">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.regular || 0))}</td>
                    <td class="prem-retail col-category">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.bonus || 0))}</td>
                    <td class="prem-retail col-category">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.nonliquid || 0))}</td>
                    <td class="prem-opt col-premium">${new Intl.NumberFormat('ru-RU').format(Math.round(premOptTotal || 0))}</td>
                    <td>${new Intl.NumberFormat('ru-RU').format(Math.round(emp.scheme || 0))}</td>
                    <td>${new Intl.NumberFormat('ru-RU').format(Math.round(emp.guarantee || 0))}</td>
                    <td class="${emp.diff < 0 ? 'text-red' : 'text-green'}">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.diff || 0))}</td>
                    <td><div class="total-column">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.total || 0))}</div></td>
                `;
                
                // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
                row.addEventListener('dblclick', function() {
                    document.querySelectorAll('#table-body tr').forEach(r => {
                        r.classList.remove('selected', 'faded');
                    });
                    
                    this.classList.add('selected');
                    
                    document.querySelectorAll('#table-body tr').forEach(r => {
                        if (r !== this) {
                            r.classList.add('faded');
                        }
                    });
                });

                // –ö–ª–∏–∫ —Å–Ω–∏–º–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                row.addEventListener('click', function() {
                    this.classList.remove('selected');
                    document.querySelectorAll('#table-body tr').forEach(r => {
                        r.classList.remove('faded');
                    });
                });
                tbody.appendChild(row);
            });
        }

        function renderStatsTable(filterDept = '', searchName = '') {
            const tbody = document.getElementById('stats-body');
            tbody.innerHTML = '';
            
            let filtered = currentData.filter(emp => {
                const deptMatch = !filterDept || emp.dept === filterDept;
                const nameMatch = !searchName || emp.fio.toLowerCase().includes(searchName.toLowerCase());
                return deptMatch && nameMatch;
            });

            filtered.forEach((emp, index) => {
                const row = document.createElement('tr');
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–æ–ª–∏
                const totalRetail = emp.dol_prem || 0;
                const totalWholesale = emp.premWholesale || 0;
                const totalOther = emp.premOther || 0;
                const totalAll = totalRetail + totalWholesale + totalOther;
                
                const pctRetail = totalAll > 0 ? (totalRetail / totalAll) * 100 : 0;
                const pctWholesale = totalAll > 0 ? (totalWholesale / totalAll) * 100 : 0;
                const pctOther = totalAll > 0 ? (totalOther / totalAll) * 100 : 0;
                
                const totalInRetail = emp.dol_prem || 1;
                const pctRegular = totalInRetail > 0 ? (emp.regular / totalInRetail) * 100 : 0;
                const pctBonus = totalInRetail > 0 ? (emp.bonus / totalInRetail) * 100 : 0;
                const pctNonliquid = totalInRetail > 0 ? (emp.nonliquid / totalInRetail) * 100 : 0;
                
                row.innerHTML = `
                    <td>${emp.fio}</td>
                    <td>${emp.dept}</td>
                    <td class="pair-group-1">${parseFloat(pctRetail).toFixed(1).replace('.', ',')} %</td>
                    <td class="pair-group-1">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.—Ä–æ–∑–Ω–∏—Ü–∞_–æ–±—â–∞—è_–∫–æ–ª–≤–æ || 0))}</td>
                    <td class="pair-group-2">${parseFloat(pctWholesale).toFixed(1).replace('.', ',')} %</td>
                    <td class="pair-group-2">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.–æ–ø—Ç_–∫–æ–ª–≤–æ || 0))}</td>
                    <td class="pair-group-3">${parseFloat(pctOther).toFixed(1).replace('.', ',')} %</td>
                    <td class="pair-group-3">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.–ø—Ä–æ—á–∞—è_–∫–æ–ª–≤–æ || 0))}</td>
                    <td class="separator"></td>
                    <td class="pair-group-4">${parseFloat(pctRegular).toFixed(1).replace('.', ',')} %</td>
                    <td class="pair-group-4">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.–æ–±—ã—á–Ω—ã–µ_–∫–æ–ª–≤–æ || 0))}</td>
                    <td class="pair-group-5">${parseFloat(pctBonus).toFixed(1).replace('.', ',')} %</td>
                    <td class="pair-group-5">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.—Ä–æ–∑–Ω–∏—Ü–∞_–±–æ–Ω—É—Å_–∫–æ–ª–≤–æ || 0))}</td>
                    <td class="pair-group-6">${parseFloat(pctNonliquid).toFixed(1).replace('.', ',')} %</td>
                    <td class="pair-group-6">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.—Ä–æ–∑–Ω–∏—Ü–∞_–Ω–µ–ª–∏–∫–≤–∏–¥_–∫–æ–ª–≤–æ || 0))}</td>
                    <td>${emp.rating.toFixed(2).replace('.', ',')} %</td>
                `;
                
                row.addEventListener('dblclick', function() {
                    document.querySelectorAll('#stats-body tr').forEach(r => {
                        r.classList.remove('selected', 'faded');
                    });
                    
                    this.classList.add('selected');
                    
                    document.querySelectorAll('#stats-body tr').forEach(r => {
                        if (r !== this) {
                            r.classList.add('faded');
                        }
                    });
                });

                row.addEventListener('click', function() {
                    this.classList.remove('selected');
                    document.querySelectorAll('#stats-body tr').forEach(r => {
                        r.classList.remove('faded');
                    });
                });
                tbody.appendChild(row);
            });
        }

        function renderZakazTable(filterDept = '', searchName = '') {
            const tbody = document.getElementById('zakaz-body');
            tbody.innerHTML = '';
            
            let filtered = currentData.filter(emp => {
                const deptMatch = !filterDept || emp.dept === filterDept;
                const nameMatch = !searchName || emp.fio.toLowerCase().includes(searchName.toLowerCase());
                return deptMatch && nameMatch;
            });

            filtered.forEach(emp => {
                const row = document.createElement('tr');
                
                const –∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ = emp.–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ || 0;
                const –∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å = emp.–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å || 0;
                const –∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ = emp.–∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ || 0;
                const –Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ = emp.–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ || 0;
                const –Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å = emp.–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å || 0;
                const –Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ = emp.–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ || 0;
                
                const totalSales = –∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ + –Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏;
                const –ø—Ä–æ—Ü–µ–Ω—Ç_–∑–∞–∫–∞–∑–Ω—ã—Ö = totalSales > 0 ? Math.round((–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ / totalSales) * 100) : 0;
                
                row.innerHTML = `
                    <td style="min-width: 120px;">${emp.fio}</td>
                    <td style="min-width: 80px;">${emp.dept}</td>
                    <td class="zakaz-group" style="min-width: 60px;">${new Intl.NumberFormat('ru-RU').format(Math.round(–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏))}</td>
                    <td class="zakaz-group" style="min-width: 60px;">${new Intl.NumberFormat('ru-RU').format(Math.round(–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å))}</td>
                    <td class="zakaz-group" style="min-width: 60px;">${new Intl.NumberFormat('ru-RU').format(Math.round(–∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ))}</td>
                    <td class="assortment-group" style="min-width: 60px;">${new Intl.NumberFormat('ru-RU').format(Math.round(–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏))}</td>
                    <td class="assortment-group" style="min-width: 60px;">${new Intl.NumberFormat('ru-RU').format(Math.round(–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å))}</td>
                    <td class="assortment-group" style="min-width: 60px;">${new Intl.NumberFormat('ru-RU').format(Math.round(–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ))}</td>
                    <td style="min-width: 350px;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div class="progress-bar" style="flex: 1; min-width: 340px;">
                                <div class="progress-fill" style="width: ${–ø—Ä–æ—Ü–µ–Ω—Ç_–∑–∞–∫–∞–∑–Ω—ã—Ö}%; background: linear-gradient(90deg, rgba(236, 72, 153, 0.7), rgba(168, 85, 247, 0.7));"></div>
                            </div>
                            <span>${–ø—Ä–æ—Ü–µ–Ω—Ç_–∑–∞–∫–∞–∑–Ω—ã—Ö}%</span>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function renderCharts() {
            const deptData = {};
            
            currentData.forEach(emp => {
                if (!deptData[emp.dept]) {
                    deptData[emp.dept] = {
                        retail: 0,
                        wholesale: 0,
                        other: 0,
                        regular: 0,
                        bonus: 0,
                        nonliquid: 0,
                        ordered: 0,
                        unordered: 0
                    };
                }
                
                deptData[emp.dept].retail += emp.dol_prem || 0;
                deptData[emp.dept].wholesale += emp.premWholesale || 0;
                deptData[emp.dept].other += emp.premOther || 0;
                deptData[emp.dept].regular += emp.regular || 0;
                deptData[emp.dept].bonus += emp.bonus || 0;
                deptData[emp.dept].nonliquid += emp.nonliquid || 0;
                deptData[emp.dept].ordered += emp.–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å || 0;
                deptData[emp.dept].unordered += emp.–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å || 0;
            });
            
            const departments = Object.keys(deptData);
            
            // === 1. –¢–ò–ü–´ –ü–†–û–î–ê–ñ (% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ø–æ –æ—Ç–¥–µ–ª—É) ===
            const retailPct = departments.map(dept => {
                const total = deptData[dept].retail + deptData[dept].wholesale + deptData[dept].other;
                return total > 0 ? (deptData[dept].retail / total) * 100 : 0;
            });
            
            const wholesalePct = departments.map(dept => {
                const total = deptData[dept].retail + deptData[dept].wholesale + deptData[dept].other;
                return total > 0 ? (deptData[dept].wholesale / total) * 100 : 0;
            });
            
            const otherPct = departments.map(dept => {
                const total = deptData[dept].retail + deptData[dept].wholesale + deptData[dept].other;
                return total > 0 ? (deptData[dept].other / total) * 100 : 0;
            });
            
            // === 2. –ö–ê–¢–ï–ì–û–†–ò–ò –¢–û–í–ê–†–û–í (% –æ—Ç —Å—É–º–º—ã —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö —á–µ–∫–æ–≤) ===
            const regularPct = departments.map(dept => {
                const total = deptData[dept].regular + deptData[dept].bonus + deptData[dept].nonliquid;
                return total > 0 ? (deptData[dept].regular / total) * 100 : 0;
            });
            
            const bonusPct = departments.map(dept => {
                const total = deptData[dept].regular + deptData[dept].bonus + deptData[dept].nonliquid;
                return total > 0 ? (deptData[dept].bonus / total) * 100 : 0;
            });
            
            const nonliquidPct = departments.map(dept => {
                const total = deptData[dept].regular + deptData[dept].bonus + deptData[dept].nonliquid;
                return total > 0 ? (deptData[dept].nonliquid / total) * 100 : 0;
            });
            
            // === 3. –ó–ê–ö–ê–ó–ù–´–ï/–ê–°–°–û–†–¢–ò–ú–ï–ù–¢–ù–´–ï (% –æ—Ç —Å—É–º–º—ã –ø—Ä–∏–±—ã–ª–∏) ===
            const orderedPct = departments.map(dept => {
                const total = deptData[dept].ordered + deptData[dept].unordered;
                return total > 0 ? (deptData[dept].ordered / total) * 100 : 0;
            });
            
            const unorderedPct = departments.map(dept => {
                const total = deptData[dept].ordered + deptData[dept].unordered;
                return total > 0 ? (deptData[dept].unordered / total) * 100 : 0;
            });
            
            // === –î–ò–ê–ì–†–ê–ú–ú–ê 1: –¢–∏–ø—ã –ø—Ä–æ–¥–∞–∂ ===
            const salesTypesCtx = document.getElementById('salesTypesChart').getContext('2d');
            
            if (window.salesTypesChart && typeof window.salesTypesChart.destroy === 'function') {
                window.salesTypesChart.destroy();
            }
            
            window.salesTypesChart = new Chart(salesTypesCtx, {
                type: 'bar',
                data: {
                    labels: departments,
                    datasets: [
                        {
                            label: '–†–æ–∑–Ω–∏—á–Ω—ã–µ –ø–æ —á–µ–∫–∞–º',
                            data: retailPct,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–û–ø—Ç–æ–≤—ã–µ',
                            data: wholesalePct,
                            backgroundColor: 'rgba(245, 158, 11, 0.7)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–†–æ–∑–Ω–∏—á–Ω—ã–µ –ø—Ä–æ—á–∏–µ',
                            data: otherPct,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1200,
                        easing: 'linear'
                    },
                    plugins: {
                        legend: { 
                            labels: { 
                                color: 'white',
                                font: { size: 14 }
                            },
                            position: 'top',
                            align: 'center',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw;
                                    const deptIndex = context.dataIndex;
                                    const absValue = deptData[departments[deptIndex]].retail + 
                                                   deptData[departments[deptIndex]].wholesale + 
                                                   deptData[departments[deptIndex]].other;
                                    return `${label}: ${value.toFixed(1)}% (${new Intl.NumberFormat('ru-RU').format(Math.round(absValue))} —Ä—É–±.)`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: 'white',
                            font: { size: 13, weight: 'normal' },
                            formatter: function(value) {
                                return value.toFixed(1).replace('.', ',') + ' %';
                            },
                            anchor: 'end',
                            align: 'top',
                            offset: 5  // ‚¨ÜÔ∏è ‚¨áÔ∏è –£–ú–ï–ù–¨–®–ï–ù–û (–±—ã–ª–æ 25)
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white',
                                font: {
                                    size: 12
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            beginAtZero: true,
                            max: 110,
                            ticks: {
                                color: 'white',
                                callback: function(value) {
                                    return value > 100 ? '' : value + '%';
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });

            // –ü–æ—Å–ª–µ window.salesTypesChart = new Chart(...)
            // HTML-–ª–µ–≥–µ–Ω–¥–∞ –¥–ª—è –ø–µ—Ä–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
            const legendHtml1 = window.salesTypesChart.legend.legendItems.map((item, index) => 
                `<span id="legend-item-sales-${index}" data-index="${index}" style="display: inline-flex; align-items: center; gap: 5px; margin-right: 15px; cursor: pointer; opacity: 1; text-decoration: none;">
                    <span style="display: inline-block; width: 12px; height: 12px; background-color: ${item.fillStyle};"></span>
                    ${item.text}
                </span>`
            ).join('');

            document.getElementById('legend-salesTypes').innerHTML = legendHtml1;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            for (let i = 0; i < window.salesTypesChart.legend.legendItems.length; i++) {
                document.getElementById(`legend-item-sales-${i}`).addEventListener('click', function() {
                    const meta = window.salesTypesChart.getDatasetMeta(i);
                    meta.hidden = !meta.hidden;
                    
                    if (meta.hidden) {
                        this.style.opacity = '0.5';
                        this.style.textDecoration = 'line-through';
                    } else {
                        this.style.opacity = '1';
                        this.style.textDecoration = 'none';
                    }
                    
                    window.salesTypesChart.update();
                });
            }

            // –°–∫—Ä—ã—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ª–µ–≥–µ–Ω–¥—É
            window.salesTypesChart.options.plugins.legend.display = false;
            window.salesTypesChart.update();
            
            // === –î–ò–ê–ì–†–ê–ú–ú–ê 2: –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ ===
            const productCategoriesCtx = document.getElementById('productCategoriesChart').getContext('2d');
            
            if (window.productCategoriesChart && typeof window.productCategoriesChart.destroy === 'function') {
                window.productCategoriesChart.destroy();
            }
            
            window.productCategoriesChart = new Chart(productCategoriesCtx, {
                type: 'bar',
                data: {
                    labels: departments,
                    datasets: [
                        {
                            label: '–û–±—ã—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                            data: regularPct,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–ë–æ–Ω—É—Å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                            data: bonusPct,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–ù–µ–ª–∏–∫–≤–∏–¥–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                            data: nonliquidPct,
                            backgroundColor: 'rgba(239, 68, 68, 0.7)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1200,
                        easing: 'easeInOutCubic'
                    },
                    plugins: {
                        legend: { 
                            labels: { 
                                color: 'white',
                                font: { size: 14 }
                            },
                            position: 'top',
                            align: 'center',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw;
                                    const deptIndex = context.dataIndex;
                                    const absValue = deptData[departments[deptIndex]].regular + 
                                                   deptData[departments[deptIndex]].bonus + 
                                                   deptData[departments[deptIndex]].nonliquid;
                                    return `${label}: ${value.toFixed(1)}% (${new Intl.NumberFormat('ru-RU').format(Math.round(absValue))} —Ä—É–±.)`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: 'white',
                            font: { size: 13, weight: 'normal' },
                            formatter: function(value) {
                                return value.toFixed(1).replace('.', ',') + ' %';
                            },
                            anchor: 'end',
                            align: 'top',
                            offset: 5  // ‚¨ÜÔ∏è –£–º–µ–Ω—å—à–µ–Ω–æ (–±—ã–ª–æ 25)
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white',
                                font: {
                                    size: 12
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            beginAtZero: true,
                            max: 110,
                            ticks: {
                                color: 'white',
                                callback: function(value) {
                                    return value > 100 ? '' : value + '%';
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });

            // –ü–æ—Å–ª–µ window.productTypesChart = new Chart(...)
            // HTML-–ª–µ–≥–µ–Ω–¥–∞ –¥–ª—è –≤—Ç–æ—Ä–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
            const legendHtml2 = window.productCategoriesChart.legend.legendItems.map((item, index) => 
                `<span id="legend-item-product-${index}" data-index="${index}" style="display: inline-flex; align-items: center; gap: 5px; margin-right: 15px; cursor: pointer; opacity: 1; text-decoration: none;">
                    <span style="display: inline-block; width: 12px; height: 12px; background-color: ${item.fillStyle};"></span>
                    ${item.text}
                </span>`
            ).join('');

            document.getElementById('legend-productCategories').innerHTML = legendHtml2;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            for (let i = 0; i < window.productCategoriesChart.legend.legendItems.length; i++) {
                document.getElementById(`legend-item-product-${i}`).addEventListener('click', function() {
                    const meta = window.productCategoriesChart.getDatasetMeta(i);
                    meta.hidden = !meta.hidden;
                    
                    if (meta.hidden) {
                        this.style.opacity = '0.5';
                        this.style.textDecoration = 'line-through';
                    } else {
                        this.style.opacity = '1';
                        this.style.textDecoration = 'none';
                    }
                    
                    window.productCategoriesChart.update();
                });
            }

            // –°–∫—Ä—ã—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ª–µ–≥–µ–Ω–¥—É
            window.productCategoriesChart.options.plugins.legend.display = false;
            window.productCategoriesChart.update();
            
            // === –î–ò–ê–ì–†–ê–ú–ú–ê 3: –ó–∞–∫–∞–∑–Ω—ã–µ vs –ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω—ã–µ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===
            const zakazCtx = document.getElementById('customVsAssortmentChart').getContext('2d');
            
            if (window.customVsAssortmentChart && typeof window.customVsAssortmentChart.destroy === 'function') {
                window.customVsAssortmentChart.destroy();
            }
            
            window.customVsAssortmentChart = new Chart(zakazCtx, {
                type: 'bar',
                data: {
                    labels: departments,
                    datasets: [
                        {
                            label: '–ó–∞–∫–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                            data: orderedPct,
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: 'rgba(236, 72, 153, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                            data: unorderedPct,
                            backgroundColor: 'rgba(168, 85, 247, 0.7)',
                            borderColor: 'rgba(168, 85, 247, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1200,
                        easing: 'easeOutBounce'
                    },
                    plugins: {
                        legend: { 
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw;
                                    const deptIndex = context.dataIndex;
                                    const absValue = deptData[departments[deptIndex]].ordered + 
                                                   deptData[departments[deptIndex]].unordered;
                                    return `${label}: ${value.toFixed(1)}% (${new Intl.NumberFormat('ru-RU').format(Math.round(absValue))} —Ä—É–±.)`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: 'white',
                            font: { size: 13, weight: 'normal' },
                            formatter: function(value) {
                                return value.toFixed(1).replace('.', ',') + ' %';
                            },
                            anchor: 'end',
                            align: 'top',
                            offset: 3
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white',
                                font: {
                                    size: 12
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            beginAtZero: true,
                            max: 110,
                            ticks: {
                                color: 'white',
                                callback: function(value) {
                                    return value > 100 ? '' : value + '%';
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    },
                    onClick: function(e) {
                        const activeElements = this.getElementsAtEvent(e);
                        if (activeElements.length > 0) {
                            const index = activeElements[0].index;
                            const meta0 = this.getDatasetMeta(0);
                            const meta1 = this.getDatasetMeta(1);
                            
                            meta0.data[index].hidden = !meta0.data[index].hidden;
                            meta1.data[index].hidden = !meta1.data[index].hidden;
                            this.update();
                        }
                    }
                }
            });
            // HTML-–ª–µ–≥–µ–Ω–¥–∞ –¥–ª—è —Ç—Ä–µ—Ç—å–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
            const legendHtml3 = window.customVsAssortmentChart.legend.legendItems.map((item, index) => 
                `<span id="legend-item-custom-${index}" data-index="${index}" style="display: inline-flex; align-items: center; gap: 5px; margin-right: 15px; cursor: pointer; opacity: 1; text-decoration: none;">
                    <span style="display: inline-block; width: 12px; height: 12px; background-color: ${item.fillStyle};"></span>
                    ${item.text}
                </span>`
            ).join('');

            document.getElementById('legend-customVsAssortment').innerHTML = legendHtml3;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            for (let i = 0; i < window.customVsAssortmentChart.legend.legendItems.length; i++) {
                document.getElementById(`legend-item-custom-${i}`).addEventListener('click', function() {
                    const meta = window.customVsAssortmentChart.getDatasetMeta(i);
                    meta.hidden = !meta.hidden;
                    
                    if (meta.hidden) {
                        this.style.opacity = '0.5';
                        this.style.textDecoration = 'line-through';
                    } else {
                        this.style.opacity = '1';
                        this.style.textDecoration = 'none';
                    }
                    
                    window.customVsAssortmentChart.update();
                });
            }

            // –°–∫—Ä—ã—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ª–µ–≥–µ–Ω–¥—É
            window.customVsAssortmentChart.options.plugins.legend.display = false;
            window.customVsAssortmentChart.update();
        }

        function changeZakazChartType(type) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
            event.target.classList.add('active');
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Å –Ω–æ–≤—ã–º —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö
            // renderZakazChart(type);
        }

        function renderZakazChart(dataType = 'items') {
            const ctx = document.getElementById('customVsAssortmentChart').getContext('2d');
            const departments = [...new Set(currentData.map(emp => emp.dept))];
            
            const orderedData = departments.map(dept => {
                let total = 0;
                currentData.forEach(emp => {
                    if (emp.dept === dept) {
                        if (dataType === 'items') total += (emp.–∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ || 0);
                        if (dataType === 'revenue') total += (emp.–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ || 0);
                        if (dataType === 'profit') total += (emp.–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å || 0);
                    }
                });
                return total;
            });
            
            const unorderedData = departments.map(dept => {
                let total = 0;
                currentData.forEach(emp => {
                    if (emp.dept === dept) {
                        if (dataType === 'items') total += (emp.–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–∫–æ–ª–≤–æ || 0);
                        if (dataType === 'revenue') total += (emp.–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–æ–¥–∞–∂–∏ || 0);
                        if (dataType === 'profit') total += (emp.–Ω–µ–∑–∞–∫–∞–∑–Ω—ã–µ_–ø—Ä–∏–±—ã–ª—å || 0);
                    }
                });
                return total;
            });

            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫, –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (window.customVsAssortmentChart && typeof window.customVsAssortmentChart.destroy === 'function') {
                window.customVsAssortmentChart.destroy();
            }

            window.customVsAssortmentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: departments,
                    datasets: [
                        {
                            label: '–ó–∞–∫–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                            data: orderedData,
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: 'rgba(236, 72, 153, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                            data: unorderedData,
                            backgroundColor: 'rgba(168, 85, 247, 0.7)',
                            borderColor: 'rgba(168, 85, 247, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            labels: { color: 'white' } 
                        },
                        datalabels: {
                            display: true,
                            color: 'white',
                            font: { size: 16, weight: 'bold' },
                            formatter: function(value, context) {
                                const deptIndex = context.dataIndex;
                                const total = orderedData[deptIndex] + unorderedData[deptIndex];
                                return total > 0 ? Math.round((value / total) * 100) + ' %' : '0 %';
                            },
                            anchor: 'end',
                            align: 'top',
                            offset: 5
                        }
                    },
                    scales: {
                        x: { 
                            ticks: { 
                                color: 'white',
                                callback: function(val, index) {
                                    const label = this.getLabelForValue(val);
                                    return label;
                                }
                            }, 
                            grid: { color: 'rgba(255, 255, 255, 0.1)' } 
                        },
                        y: { 
                            beginAtZero: true, 
                            ticks: { color: 'white' }, 
                            grid: { color: 'rgba(255, 255, 255, 0.1)' } 
                        }
                    },
                    onClick: function(e) {
                        const activeElements = Chart.helpers.getElementsAtEvent(this, e);
                        if (activeElements.length > 0) {
                            const index = activeElements[0].index;
                            const meta0 = this.getDatasetMeta(0);
                            const meta1 = this.getDatasetMeta(1);
                            
                            meta0.data[index].hidden = !meta0.data[index].hidden;
                            meta1.data[index].hidden = !meta1.data[index].hidden;
                            this.update();
                        }
                    }
                }
            });
        }
        
        function renderTop5() {
            const sorted = [...currentData].sort((a, b) => b.total - a.total).slice(0, 5);
            const grid = document.getElementById('top5-grid');
            grid.innerHTML = sorted.map((emp, i) => {
                const totalRevenue = emp.dol_prem + emp.premWholesale + emp.premOther;
                const pctRetail = totalRevenue > 0 ? (emp.dol_prem / totalRevenue * 100).toFixed(0) : 0;
                const pctWholesale = totalRevenue > 0 ? (emp.premWholesale / totalRevenue * 100).toFixed(0) : 0;
                const pctOther = totalRevenue > 0 ? (emp.premOther / totalRevenue * 100).toFixed(0) : 0;
                const pctRegular = emp.dol_prem > 0 ? (emp.regular / emp.dol_prem * 100).toFixed(0) : 0;
                const pctBonus = emp.dol_prem > 0 ? (emp.bonus / emp.dol_prem * 100).toFixed(0) : 0;
                const pctNonliquid = emp.dol_prem > 0 ? (emp.nonliquid / emp.dol_prem * 100).toFixed(0) : 0;

                return `
                    <div class="rank-card">
                        <div>
                            <span class="rank-number">${i+1}</span>
                            <span class="rank-name">${emp.fio}</span>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-gray);">${emp.dept}</div>
                        <div style="margin-top: 0.8rem; font-size: 1.3rem; font-weight: 600;">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.total))}</div>
                        <div class="rank-details" style="margin-top: 0.8rem;">
                            <div>–†–æ–∑–Ω.—á–µ–∫–∏: <span class="text-cyan">${pctRetail} %</span></div>
                            <div>–û–ø—Ç: <span class="text-cyan">${pctWholesale} %</span></div>
                            <div>–ü—Ä–æ—á–∞—è: <span class="text-cyan">${pctOther} %</span></div>
                            <div>%–æ–±—ã—á–Ω: <span class="text-green">${pctRegular} %</span></div>
                            <div>%–±–æ–Ω—É—Å: <span class="text-yellow">${pctBonus} %</span></div>
                            <div>%–Ω–µ–ª–∏–∫: <span class="text-red">${pctNonliquid} %</span></div>
                            <div>–ß–∞—Å—ã: ${emp.worked.toFixed(1)}/${emp.norm.toFixed(1)}</div>
                            <div>–ü–æ—Ç–µ—Ä—è: <span class="${emp.diff < 0 ? 'text-red' : 'text-green'}">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.diff))}</span></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAntiTop5() {
            const sorted = [...currentData].sort((a, b) => a.total - b.total).slice(0, 5);
            const grid = document.getElementById('antitop5-grid');
            grid.innerHTML = sorted.map((emp, i) => {
                const totalRevenue = emp.dol_prem + emp.premWholesale + emp.premOther;
                const pctRetail = totalRevenue > 0 ? (emp.dol_prem / totalRevenue * 100).toFixed(0) : 0;
                const pctWholesale = totalRevenue > 0 ? (emp.premWholesale / totalRevenue * 100).toFixed(0) : 0;
                const pctOther = totalRevenue > 0 ? (emp.premOther / totalRevenue * 100).toFixed(0) : 0;

                return `
                    <div class="rank-card anti">
                        <div>
                            <span class="rank-number">${i+1}</span>
                            <span class="rank-name">${emp.fio}</span>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-gray);">${emp.dept}</div>
                        <div style="margin-top: 0.8rem; font-size: 1.3rem; font-weight: 600;">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.total))}</div>
                        <div class="rank-details" style="margin-top: 0.8rem;">
                            <div>–†–æ–∑–Ω.—á–µ–∫–∏: ${pctRetail} %</div>
                            <div>–û–ø—Ç: ${pctWholesale} %</div>
                            <div>–ü—Ä–æ—á–∞—è: ${pctOther} %</div>
                            <div>–ß–∞—Å—ã: ${emp.worked.toFixed(1)}/${emp.norm.toFixed(1)}</div>
                            <div>–ü–æ—Ç–µ—Ä—è: <span class="text-red">${new Intl.NumberFormat('ru-RU').format(Math.round(emp.diff))}</span></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderLeaders() {
            const byBonus = [...currentData].sort((a, b) => b.bonus - a.bonus).slice(0, 5);
            const byNonliquid = [...currentData].sort((a, b) => b.nonliquid - a.nonliquid).slice(0, 5);
            const byRetail = [...currentData].sort((a, b) => b.dol_prem - a.dol_prem).slice(0, 5);
            const byWholesale = [...currentData].sort((a, b) => b.premWholesale - a.premWholesale).slice(0, 5);

            document.getElementById('leaders-bonus').innerHTML = byBonus.map((e, i) => 
                `<div class="leader-item"><span>${i+1}. ${e.fio}</span><span>${new Intl.NumberFormat('ru-RU').format(Math.round(e.bonus))}</span></div>`
            ).join('');

            document.getElementById('leaders-nonliquid').innerHTML = byNonliquid.map((e, i) => 
                `<div class="leader-item"><span>${i+1}. ${e.fio}</span><span>${new Intl.NumberFormat('ru-RU').format(Math.round(e.nonliquid))}</span></div>`
            ).join('');

            document.getElementById('leaders-retail').innerHTML = byRetail.map((e, i) => 
                `<div class="leader-item"><span>${i+1}. ${e.fio}</span><span>${new Intl.NumberFormat('ru-RU').format(Math.round(e.dol_prem))}</span></div>`
            ).join('');

            document.getElementById('leaders-wholesale').innerHTML = byWholesale.map((e, i) => 
                `<div class="leader-item"><span>${i+1}. ${e.fio}</span><span>${new Intl.NumberFormat('ru-RU').format(Math.round(e.premWholesale))}</span></div>`
            ).join('');
        }

        function renderProblems() {
            const lowEfficiency = currentData.filter(e => e.worked > 100 && (e.dol_prem / e.worked) < 500).slice(0, 5);
            document.getElementById('problem-efficiency').innerHTML = lowEfficiency.map(e => 
                `<tr>
                    <td>${e.fio}</td>
                    <td>${e.dept}</td>
                    <td>${e.worked.toFixed(1)}</td>
                    <td>${new Intl.NumberFormat('ru-RU').format(Math.round(e.dol_prem))}</td>
                    <td class="text-red">${new Intl.NumberFormat('ru-RU').format(Math.round(e.dol_prem / e.worked))}/—á–∞—Å</td>
                </tr>`
            ).join('');

            const withMinimum = currentData.filter(e => 
                e.scheme === e.minimum  // –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏—Ç–æ–≥–æ–≤–∞—è —Ä–∞–≤–Ω–∞ –º–∏–Ω–∏–º–∞–ª–∫–µ
            ).slice(0, 5);
            document.getElementById('problem-minimum').innerHTML = withMinimum.map(e => 
                `<tr>
                    <td>${e.fio}</td>
                    <td>${e.dept}</td>
                    <td>${new Intl.NumberFormat('ru-RU').format(Math.round(e.total))}</td>
                    <td class="text-red">+${new Intl.NumberFormat('ru-RU').format(Math.round(e.guarantee))}</td>
                </tr>`
            ).join('');

            const withAbsences = currentData.filter(e => (e.vacation + e.weekend + e.sick) > 5).slice(0, 5);
            document.getElementById('problem-absences').innerHTML = withAbsences.map(e => {
                const total = e.vacation + e.weekend + e.sick;
                return `<tr>
                    <td>${e.fio}</td>
                    <td>${e.dept}</td>
                    <td>${e.vacation}</td>
                    <td>${e.weekend}</td>
                    <td>${e.sick}</td>
                    <td class="text-red">${total} –¥–Ω–µ–π</td>
                </tr>`;
            }).join('');
        }

        function renderDeptStats() {
            const deptStats = {};
            currentData.forEach(emp => {
                const dept = emp.dept;
                if (!deptStats[dept]) {
                    deptStats[dept] = {
                        count: 0,
                        totalSalary: 0,
                        totalHours: 0,
                        totalNorm: 0,
                        totalVacation: 0,
                        totalWeekend: 0,
                        totalSick: 0,
                        totalNoShow: 0
                    };
                }
                deptStats[dept].count++;
                deptStats[dept].totalSalary += emp.total;
                deptStats[dept].totalHours += emp.worked;
                deptStats[dept].totalNorm += emp.norm;
                deptStats[dept].totalVacation += emp.vacation || 0;
                deptStats[dept].totalWeekend += emp.weekend || 0;
                deptStats[dept].totalSick += emp.sick || 0;
            });

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            let deptArray = Object.entries(deptStats).map(([dept, stats]) => {
                const avgSalary = stats.count > 0 ? stats.totalSalary / stats.count : 0;
                const completion = stats.totalNorm > 0 ? (stats.totalHours / stats.totalNorm * 100).toFixed(1) : 0;
                return {
                    dept,
                    count: stats.count,
                    avgSalary,
                    totalHours: stats.totalHours,
                    totalNorm: stats.totalNorm,
                    totalWeekend: stats.totalWeekend,
                    totalVacation: stats.totalVacation,
                    totalSick: stats.totalSick,
                    totalNoShow: stats.totalNoShow,
                    completion: parseFloat(completion)
                };
            });

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            let sortColumn = 'dept';
            let sortAsc = true;

            // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            function sortDeptStats(column) {
                if (sortColumn === column) {
                    sortAsc = !sortAsc;
                } else {
                    sortColumn = column;
                    sortAsc = true;
                }

                deptArray.sort((a, b) => {
                    let aVal = a[column];
                    let bVal = b[column];
                    
                    // –î–ª—è —Å—Ç—Ä–æ–∫
                    if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }
                    
                    if (sortAsc) {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });

                renderTable();
            }

            // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
            function renderTable() {
                const tbody = document.getElementById('dept-stats');
                tbody.innerHTML = deptArray.map(item => `
                    <tr>
                        <td style="min-width: 80px;">${item.dept}</td>
                        <td>${item.count}</td>
                        <td>${new Intl.NumberFormat('ru-RU').format(Math.round(item.avgSalary || 0))}</td>
                        <td>${new Intl.NumberFormat('ru-RU').format(Math.round(item.totalHours || 0))}</td>
                        <td>${new Intl.NumberFormat('ru-RU').format(Math.round(item.totalNorm || 0))}</td>
                        <td>${item.totalWeekend}</td>
                        <td>${item.totalVacation}</td>
                        <td>${item.totalSick}</td>
                        <td>${item.totalNoShow}</td>
                        <td style="min-width: 220px;">
                            <div>${item.completion.toFixed(1)} %</div>
                            <div class="progress-bar">
                                <div class="progress-fill ${item.completion < 90 ? 'low' : ''}" style="width: ${Math.min(item.completion, 100)}%"></div>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏
            const headers = document.querySelector('#dept-stats').closest('table').querySelectorAll('th');
            const columns = ['dept', 'count', 'avgSalary', 'totalHours', 'totalNorm', 'totalWeekend', 'totalVacation', 'totalSick', 'totalNoShow', 'completion'];
            
            headers.forEach((th, index) => {
                th.style.cursor = 'pointer';
                th.title = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏';
                th.addEventListener('click', () => {
                    sortDeptStats(columns[index]);
                });
            });

            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
            renderTable();
        }

        function updateDeptFilter() {
            if (!currentData || currentData.length === 0) return;
    
            const depts = [...new Set(currentData.map(e => e.dept))].sort();
            const select = document.getElementById('dept-filter');
            const selectStats = document.getElementById('dept-filter-stats');
            const selectZakaz = document.getElementById('dept-filter-zakaz');
            
            const options = '<option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã</option>' + 
                depts.map(d => `<option value="${d}">${d}</option>`).join('');
            
            if (select) select.innerHTML = options;
            if (selectStats) selectStats.innerHTML = options;
            if (selectZakaz) selectZakaz.innerHTML = options;
        }

        function updateKPI() {
            // 1. –û—Ç–¥–µ–ª—ã / –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
            const uniqueDepts = new Set(currentData.map(e => e.dept)).size;
            const totalEmployees = currentData.length;
            document.getElementById('kpi-depts-emps').textContent = 
                `${uniqueDepts} / ${totalEmployees}`;
            
            // 2. –ù–æ—Ä–º—ã —á–∞—Å–æ–≤ (–º–∞–≥–∞–∑–∏–Ω –∏ –æ—Ñ–∏—Å)
            const shopNorms = currentData.filter(e => e.norm !== 168).map(e => e.norm);
            const officeNorms = currentData.filter(e => e.norm === 168).map(e => e.norm);
            
            let shopNorm = shopNorms.length > 0 ? shopNorms[0].toFixed(1).replace('.', ',') : '0';
            let officeNorm = officeNorms.length > 0 ? officeNorms[0].toFixed(0) : '168';
            
            document.getElementById('kpi-norms').textContent = 
                `${shopNorm} / ${officeNorm}`;
            
            // 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è (—Å—É–º–º—ã)
            const totalVacation = currentData.reduce((sum, e) => sum + (e.vacation || 0), 0);
            const totalWeekend = currentData.reduce((sum, e) => sum + (e.weekend || 0), 0);
            const totalSick = currentData.reduce((sum, e) => sum + (e.sick || 0), 0);
            const totalNoShow = currentData.reduce((sum, e) => sum + (e.no_show || 0), 0);
            
            document.getElementById('kpi-absences').textContent = 
                `${totalVacation} / ${totalWeekend} / ${totalSick} / ${totalNoShow}`;
        }

        function loadBranch(branch) {
            // –ï—Å–ª–∏ –≤–≤–µ–ª–∏ –ø–∞—Ä–æ–ª—å —Ñ–∏–ª–∏–∞–ª–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç —Ñ–∏–ª–∏–∞–ª
            if (currentAccess !== 'ALL' && currentAccess !== branch) {
                // –ù–µ –¥–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ —Ñ–∏–ª–∏–∞–ª–∞
                alert('–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Ñ–∏–ª–∏–∞–ª—É ' + currentAccess.toUpperCase());
                return;
            }
            
            currentData = allData[branch] || [];
            currentBranch = branch;
            console.log('currentData length:', currentData.length);
            console.log('Sample data:', currentData[0]);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.branch-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.branch === branch);
            });

            updateKPI();
            updateDeptFilter();
            renderTable();
            // –î–µ–ª–∞–µ–º –∫–æ–ª–æ–Ω–∫—É –ò–¢–û–ì–û –∫–Ω–æ–ø–∫–æ–π –¥–ª—è —Å—É–º–º—ã
            const totalHeader = document.querySelector('#main-table th:last-child');
            if (totalHeader) {
                totalHeader.style.cursor = 'pointer';
                totalHeader.title = '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Å—É–º–º—É';
                totalHeader.onclick = calculateTotal;
            }
            setupSorting();
            renderStatsTable();
            renderZakazTable();
            renderTop5();
            renderAntiTop5();
            renderLeaders();
            renderProblems();
            renderDeptStats();
            renderCharts();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        // 1. –ö–Ω–æ–ø–∫–∞ "–ò–¢–û–ì–û"
        

        function calculateTotal() {
            const currentDept = document.getElementById('dept-filter').value;
            const currentSearch = document.getElementById('name-search').value;
            
            let filtered = currentData.filter(emp => {
                const deptMatch = !currentDept || emp.dept === currentDept;
                const nameMatch = !currentSearch || emp.fio.toLowerCase().includes(currentSearch.toLowerCase());
                return deptMatch && nameMatch;
            });
            
            const totalSum = filtered.reduce((sum, emp) => sum + (emp.total || 0), 0);
            
            // –°–æ–∑–¥–∞–µ–º —Å–≤–æ–µ –æ–∫–Ω–æ
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.9)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '10000';
            
            modal.innerHTML = `
                <div style="background: var(--bg-card); padding: 2rem; border-radius: 12px; max-width: 500px; text-align: center; font-size: 18px;">
                    <h3 style="margin-bottom: 1rem; color: var(--blue-light); font-size: 22px;">üí∞ –°—É–º–º–∞ –∏—Ç–æ–≥–æ–≤—ã—Ö –∑–∞—Ä–ø–ª–∞—Ç</h3>
                    <div style="font-size: 24px; font-weight: bold; margin: 1rem 0; color: var(--text-white);">
                        ${new Intl.NumberFormat('ru-RU').format(Math.round(totalSum))} —Ä—É–±.
                    </div>
                    <div style="color: var(--text-gray); font-size: 16px; margin: 0.5rem 0;">
                        üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${filtered.length}
                    </div>
                    ${currentDept ? `<div style="color: var(--cyan); font-size: 16px;">üè¢ –û—Ç–¥–µ–ª: ${currentDept}</div>` : ''}
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="margin-top: 1.5rem; padding: 0.8rem 2rem; background: var(--blue-light); color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // 2. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
        let currentSortColumn = null;
        let sortAscending = true;

        function sortTable(columnIndex) {
            const tbody = document.getElementById('table-body');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                let aVal = a.cells[columnIndex].textContent;
                let bVal = b.cells[columnIndex].textContent;
                
                // –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
                if (columnIndex === 5 || columnIndex === 6 || columnIndex === 11 || columnIndex === 12) { // –ß–∞—Å—ã, –î–æ–ª—è, –ü—Ä–µ–º–∏—è –æ–ø—Ç, –°—Ö–µ–º–∞
                    aVal = parseFloat(aVal.replace(/[^\d,.-]/g, '').replace(',', '.'));
                    bVal = parseFloat(bVal.replace(/[^\d,.-]/g, '').replace(',', '.'));
                }
                
                if (sortAscending) {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            // –û—á–∏—â–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
            
            // –ú–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–ª–∏–∫–∞
            sortAscending = !sortAscending;
            currentSortColumn = columnIndex;
        }

        function setupSorting() {
            const headers = document.querySelectorAll('#main-table th');
            const sortableColumns = {
                0: '–§–ò–û',   // –ò–Ω–¥–µ–∫—Å 0
                1: '–û—Ç–¥–µ–ª',
                5: '–ß–∞—Å—ã',  // –ò–Ω–¥–µ–∫—Å 5
                6: '–î–æ–ª—è',  // –ò–Ω–¥–µ–∫—Å 6
                11: '–ü—Ä–µ–º–∏—è –æ–ø—Ç', // –ò–Ω–¥–µ–∫—Å 11
                12: '–°—Ö–µ–º–∞', // –ò–Ω–¥–µ–∫—Å 12
                15: '–ò–¢–û–ì–û' // –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞
            };
            
            headers.forEach((th, index) => {
                if (sortableColumns[index]) {
                    th.style.cursor = 'pointer';
                    th.title = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏';
                    th.addEventListener('click', () => sortTable(index));
                }
            });
        }

        
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            document.getElementById('loginBtn').addEventListener('click', checkPassword);
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') checkPassword();
            });
            
            document.getElementById('dept-filter-zakaz').addEventListener('change', (e) => {
                renderZakazTable(e.target.value, document.getElementById('name-search-zakaz').value);
            });

            document.getElementById('name-search-zakaz').addEventListener('input', (e) => {
                renderZakazTable(document.getElementById('dept-filter-zakaz').value, e.target.value);
            });
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
            document.getElementById('passwordInput').focus();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
            document.querySelectorAll('.branch-btn').forEach(btn => {
                btn.addEventListener('click', () => loadBranch(btn.dataset.branch));
            });

            document.getElementById('dept-filter').addEventListener('change', (e) => {
                renderTable(e.target.value, document.getElementById('name-search').value);
            });

            document.getElementById('name-search').addEventListener('input', (e) => {
                renderTable(document.getElementById('dept-filter').value, e.target.value);
            });

            document.getElementById('dept-filter-stats').addEventListener('change', (e) => {
                renderStatsTable(e.target.value, document.getElementById('name-search-stats').value);
            });

            document.getElementById('name-search-stats').addEventListener('input', (e) => {
                renderStatsTable(document.getElementById('dept-filter-stats').value, e.target.value);
            });
            
            document.getElementById('dept-filter-zakaz').addEventListener('change', (e) => {
                renderZakazTable(e.target.value, document.getElementById('name-search-zakaz').value);
            });

            document.getElementById('name-search-zakaz').addEventListener('input', (e) => {
                renderZakazTable(document.getElementById('dept-filter-zakaz').value, e.target.value);
            });
        });
    </script>
</body>
</html>
